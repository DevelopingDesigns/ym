/**
 * SuperSide Me main js engine
 * @package   SuperSideMe
 * @author    Robin Cornett <hello@robincornett.com>
 * @copyright 2015-2016 Robin Cornett
 * @license   GPL-2.0+
 */
!function(e,n,s){"use strict";function a(e){t(e),(O.params.search.button||C())&&r(),0!==_.button.length&&(n(_.button).on("click.supersideme",function(){i()}),n("undefined"!==O.params.second.button)&&n(O.params.second.button).on("click.second-ssme",function(){f(O.params.second)}),n(window).on("resize.supersideme",E).triggerHandler("resize.supersideme"))}function t(e){var s=O.params.navarialabel,a=W.screenReader,t=n(O.params.location).length>0?O.params.location:"body";O.params.navigation&&(s=O.params.navigation,a="label"),C()&&(s=parent.wp.customize.instance("supersideme[navigation]").get());var r=n("<button />",{role:"button","aria-pressed":!1,"aria-expanded":!1,"aria-controls":I.panel,id:e,"class":W.menuButton}).append(n("<span />",{"class":a,text:s}));n(t)[O.params["function"]](r),n("body").addClass(W.body)}function r(){if(O.params.search.input){var e=O.params.search.button_aria,s=W.screenReader,a="left"===O.params.side?"after":"before";O.params.search.button_text&&(e=O.params.search.button_text,s="label"),C()&&(e=parent.wp.customize.instance("supersideme[search_button_text]").get());var t=n("<button />",{role:"button","aria-pressed":!1,id:W.searchButton,"class":W.searchButton}).append(n("<span />",{"class":s,text:e}));O.params.location&&"body"!==O.params.location||n(_.button).wrap("<div />"),n(_.button).parent().addClass(W.buttonWrap),n(_.button)[a](t);var r=n(_.buttonWrap),i="after",o="last-of-type",u=n(_.searchButton),p="";"0px"===r.css("bottom")&&n.inArray(r.css("position"),["absolute","fixed"])>-1&&(i="before",o="first-of-type",p=-5),n(_.buttonWrap+" > button:"+o)[i](O.params.search.input),n(_.searchInput).css("display","none").css("order",p),O.params.search.button||u.css("display","none"),u.on("click.search",function(){n(_.searchInput).slideToggle(200),T(u,"aria-pressed")})}}function i(){m(),S=!0,n.sidr("open",I.panel)}function o(){return n.sidr("close",I.panel),n(_.sidr+" "+_.submenuToggle).removeClass(W.menuOpen).attr("aria-expanded",!1).next(".sub-menu").slideUp("fast"),!1}function u(e){var s=n("body");return x(e)?void s.removeClass(W.body):void s.addClass(W.body)}function p(){if(0!==I.panel.length&&x(I.panel)){var n=e.getElementById(I.panel);n.style.setProperty("display","block")}}function d(e,s){return x(e)?void n(s).swipe("disable"):(n(s).swipe("enable"),void c(n(s)))}function l(e){var s=O.skipLinks.startLink,a=e,t=n(O.skipLinks.ulClass+' a[href*="#'+O.skipLinks.contains+'"]').not('a[href*="'+O.skipLinks.unique+'"]');x(e)?(s=e,a=O.skipLinks.startLink,n(t).removeAttr("style")):n(t).hide();var r=n(O.skipLinks.ulClass+' a[href*="#'+s+'"]'),i=n(r).attr("href");i&&(i=i.replace(s,a),n(r).attr("href",i))}function c(e){var n=i,s=o;"left"===O.params.side&&(n=o,s=i),e.swipe({allowPageScroll:"vertical",threshold:120,swipeLeft:n,swipeRight:s,preventDefaultEvents:!1})}function m(){var s=null!==O.params.source&&null!==e.getElementById(O.params.source)?"#"+O.params.source:function(){h()},a={button:_.menuButton,source:s,panel:I.panel,side:O.params.side},t=n(I.panel+" "+_.submenuToggle);return b(n(a.button),a),0===t.length&&(v(),y(),n(_.sidr+" "+_.submenuToggle).on("click.supersideme-submenu",k)),w(a.panel),n.sidr("open",a.panel),!1}function f(e){var s=n(e.button);return b(s,e),w(e.panel),n.sidr("open",e.panel),!1}function b(e,n){e.sidr({name:n.panel,side:n.side,source:n.source,renaming:!1,displace:O.params.displace,speed:parseInt(O.params.speed,10),onOpen:function(){e.toggleClass(W.menuOpen),T(e,"aria-pressed"),T(e,"aria-expanded"),g(e)},onClose:function(){e.removeClass(W.menuOpen),T(e,"aria-pressed"),T(e,"aria-expanded"),S=!1}})}function g(e){var s=n(_.sidr),a=s.children(),t=a.first(),r=a.last();s.attr({tabindex:"0"}).focus(),s.on("keydown.sidrNav",function(n){if(9===n.keyCode)return(r[0]!==n.target||n.shiftKey)&&(t[0]!==n.target&&s[0]!==n.target||!n.shiftKey)?void 0:(e.focus(),!1)}),e.on("keydown.sidrNav",function(n){if(9===n.keyCode)return e[0]!==n.target||n.shiftKey?void 0:(t.focus(),!1)})}function h(){var e=n("<nav />",{"class":"side-navigation",role:"navigation",itemscope:"itemscope",itemtype:"http://schema.org/SiteNavigationElement"}).append(n("<ul />",{"class":"side-nav"})),s=n("<div />",{"class":"sidr-inner"}),a={widget:".supersideme.widget-area",inner:_.panel+" "+_.sidr+"-inner"};0===n(a.inner).length&&(n(_.sidr).prepend(s),O.params.search.panel&&(n(a.inner).prepend(O.params.search.input),"0"===O.params.search_on&&n(".search-me").css("display","none")),O.params.menus&&(n(a.inner).append(e),n(".side-nav").prepend(O.params.menus)),p(),0!==n(a.widget).length&&n(a.widget).appendTo(a.inner).attr("style","display:block;"))}function v(){var e=n("<button />",{role:"button","aria-pressed":!1,"aria-label":O.params.subarialabel,"class":W.submenuToggle}).append(n("<span />",{"class":W.screenReader,text:O.params.submenu}));0===n(_.sidr+" "+_.submenuToggle).length&&(n(_.sidr+" .sub-menu").before(e),L(_.sidr+" .menu-item-has-children > a",_.sidr+" "+_.submenuToggle))}function y(){var e=n(_.sidr+' .menu-item-has-children > a[href="#"]');e.addClass(W.submenuToggle).attr("role","button").attr("aria-pressed",!1).next(_.submenuToggle).remove()}function k(){var e=n(this),s=e.closest(".menu-item").siblings();T(e,"aria-pressed"),e.toggleClass(W.menuOpen),e.next(".sub-menu").slideToggle("fast"),s.find(_.submenuToggle).removeClass(W.menuOpen).attr("aria-pressed",!1),s.find(".sub-menu").slideUp("fast")}function w(e){var s=e.indexOf("#")<=0?"#"+e:e;0===n(s+" .menu-close").length&&n(s+" "+_.sidr+"-inner").prepend(O.params.close),n(O.params.closeevent).on("click",function(){n(this).attr("aria-pressed",!1),n.sidr("close",e),n(_.sidr+" "+_.submenuToggle).removeClass(W.menuOpen).attr("aria-expanded",!1).next(".sub-menu").slideUp("fast")})}function x(n){var s=e.getElementById(n),a=window.getComputedStyle(s);return"none"===a.getPropertyValue("display")}function T(e,n){e.attr(n,function(e,n){return"false"===n})}function C(){return Boolean(O.params.search_on)}function B(e,n,s){var a;return function(){var t=this,r=arguments,i=function(){a=null,s||e.apply(t,r)},o=s&&!a;clearTimeout(a),a=setTimeout(i,n),o&&e.apply(t,r)}}function L(e,s){n(s).css("height",n(e).outerHeight())}var O={},S=!1,I={button:"slide-menu",panel:"side-menu"},W={sidr:"sidr",menuButton:"slide-nav-link",submenuToggle:"sub-menu-toggle",menuOpen:"menu-open",searchButton:"ssme-search",buttonWrap:"ssme-buttons",screenReader:"screen-reader-text",body:"supersideme"},_={sidr:"."+W.sidr,panel:"#"+I.panel,menuButton:"."+W.menuButton,submenuToggle:"."+W.submenuToggle,button:"#"+I.button,searchButton:"."+W.searchButton,buttonWrap:"."+W.buttonWrap,searchInput:"."+W.buttonWrap+" .search-me"};O.init=function(){a(I.button)};var E=B(function(){u(I.button),O.params.swipe&&d(I.button,"body"),O.skipLinks="undefined"==typeof supersidemeSkipLinks?"":supersidemeSkipLinks,"undefined"!=typeof O.skipLinks&&l(I.button),n(_.searchInput).hide(),o()},250);n(e).ready(function(){O.params="undefined"==typeof SuperSideMeVar?"":SuperSideMeVar,"undefined"!=typeof O.params&&O.init()})}(document,jQuery);